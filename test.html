<<<<<<< HEAD
 <html>
	<head>
		<title>Kanvas</title>
		
		<script type="application/javascript", src="lib/jquery.js"></script>
		
	</head>  
	<body style="overflow: hidden">  
		<script type="application/javascript", src="js/KContext.js"></script>
		
		<script>
			
			var canvas = document.createElement('canvas');
			canvas.width = document.body.getBoundingClientRect().width;
			canvas.height = document.body.getBoundingClientRect().height;
			document.body.appendChild(canvas);
			var context = canvas.getContext('2d');
			
			var COLOR1 = '#EDC9AF';
			var COLOR2 = '#dd9999';
			var COLOR3 = '#cc8080';
			var COLOR4 = '#aa6565';
			var COLOR5 = '#995533';
			var COLOR6 = '#995533';
			var COLOR7 = '#662211';
			var COLOR8 = '#662211';
			
			var allThings = [];
			for(var ii = 0; ii < 30; ii += 1){
				allThings.push({	xx:Math.random()*canvas.width,
									yy:Math.random()*canvas.height,
									rr:Math.random()*Math.PI*2	})
			}
			var ii = 0;
			var nn = 0;
			var pi2 = Math.PI*2;
			var pihalf = Math.PI/2;
			function draw(){
				//context.fillStyle = COLOR2;
				//context.fillRect(0,0,canvas.width,canvas.height);
				for(ii in allThings){
					//allThings[ii].rr += 0.03;
					//allThings[ii].xx += 2;
					//allThings[ii].xx %= canvas.width;
					
					//context.save();
					//context.translate(allThings[ii].xx,allThings[ii].yy);
					//context.rotate(allThings[ii].rr);
					//context.scale(allThings[ii].scale,allThings[ii].scale);
					
					for(nn = 0; nn < pi2; nn += pihalf){
						//context.fillStyle = COLOR7;
						//context.fillArc(Math.cos(nn)*73,Math.sin(nn)*73,7);
						//context.fillStyle = COLOR5;
						//context.fillArc(Math.cos(nn)*73,Math.sin(nn)*73,5);
					}
					
					//context.fillStyle = COLOR7;
					//context.fillArc(0,0,15);
					//context.fillRect(-70,-4,140,8);
					//context.fillRect(-4,-70,8,140);
					//context.fillStyle = COLOR5;
					//context.fillRect(-72,-2,144,4);
					//context.fillRect(-2,-72,4,144);
					//context.fillArc(0,0,13);
					
					//context.fillStyle = COLOR1;
					//context.fillArc(0,0,9);
					//context.restore();
				}
			}
			
			setInterval(draw, 1000/60);
			
		</script>
		
	</body>  
</html>  
=======
<html>
	<head>
		<title>My first Three.js app</title>
		<style>canvas { width: 100%; height: 100% }</style>
	</head>
	<body>
		<script src="https://rawgithub.com/mrdoob/three.js/master/build/three.js"></script>
		<script>
		
		var keys = []
		
		document.addEventListener('keydown', function(ev){keys[ev.keyCode] = true})
		document.addEventListener('keyup', function(ev){keys[ev.keyCode] = false})
		
		
		
		var scene = new THREE.Scene();
		var light1 = new THREE.AmbientLight('#444444');
		var light2 = new THREE.HemisphereLight('#ffffff','#444444', 1);
		light2.position.set( 1, 1, 0 );
		scene.add(light1);
		scene.add(light2);
		
		
		var client = new XMLHttpRequest();
		var startedParse = false;
		var finishedParse = false;
		client.open('GET', 'csz_	test.vmf');
		client.onreadystatechange = function() {
			parseMapJSON(client.responseText)
		}
		client.send();
		var calledLength = -1;
		function parseMapJSON(data){
			
			if(!data || !data.charAt(0))return false;
			if(calledLength!=data.length){
				calledLength = data.length;
				return false;
			}
			if(startedParse)return false;
			startedParse = true;
			var finalData = {}
			
			var prevActive = []
			var length = data.length;
			var active = finalData;
			var waitingName;
			var propName = null;
			console.log(length);
			function parseData(string){
				
				if(string == "{"){
					if(!waitingName)console.error('reached { but no waiting name')
				
					var newObject = {};
					newObject.name = waitingName; 
					
					prevActive.push(active);
					
					if(!active[waitingName])active[waitingName] = newObject;
					else {
						if(!active[waitingName].length)active[waitingName] = [active[waitingName]];
						active[waitingName].push(newObject);
					}
					
					waitingName = null;
					active = newObject;
					return;
				}else if(waitingName)console.error('expected { but found none');
				
				if(string == "}"){
					if(!prevActive.length)console.error('reached } with no fall back');
					active = prevActive.pop();
					
					return;
				}
				
				if(string.charAt(0) != '"'){
					waitingName = string;
					return;
				}
				
				string = string.substring(1, string.length-1); //- cut quotations
				
				if(!propName)propName = string;
				else{
					active[propName] = string;
					propName = null;
				}
			}
			
			var spaces = [0, 9, 10, 13, 32]
			var code,letter;
			var word = "";
			var ignoringSpaces = false;
			for(var ii = 0; ii < length; ii += 1){
				
				code = data.charCodeAt(ii);
				letter = data[ii];
				
				if(!letter)continue;
				
				if(letter == '"')ignoringSpaces = !ignoringSpaces;
				if(ignoringSpaces || spaces.indexOf(code) == -1)word = word + letter
				else{
					if(word.length)parseData(word);
					word = "";
				}
				
			}
			
			//console.log(active);
			
			// - parse solids
			var solids = [];
			var curSolid,curSide;
			var newSolid;
			var newVert, newVerts, newFace;
			var vertWords, clear;
			var letters = ['a','b','c'];
			var even = false;
			word = "";
			if(!active.world.solid.length)active.world.solid = [active.world.solid];
			for(var solid in active.world.solid){
				//console.log('new solid?');
			
				curSolid = active.world.solid[solid];
				newSolid = new THREE.Geometry();
				newSolid.planes = [];
				even = false;
				for(var side in curSolid.side){
					even = !even;
					curSide = curSolid.side[side];
					vertWords = [];
					newVerts = [];
					word = "";
					newPlane = {};
					newPlane.verts = []

					for(var pp in curSide.plane){
						if(curSide.plane.charCodeAt(pp) != 32)word = word + curSide.plane.charAt(pp)
						else{
							//console.log(word);
							if(word.length)vertWords.push(word);
							word = "";
						}
					}
					if(word.length)vertWords.push(word);
					
					for(var vw = 0, on = 0; vw < vertWords.length; vw+=3, on+=1){
						newVert = new THREE.Vector3(
							Number(vertWords[vw].substring(1, vertWords[vw].length)),
							Number(vertWords[vw+2].substring(0, vertWords[vw+2].length-1)),
							Number(vertWords[vw+1])
						);
						newVert.refs = [newPlane];
						//if(Math.random()<0.001)console.log(newVert);
						altID = null;
						for(var vv in newSolid.vertices){
							if(	Math.abs(newSolid.vertices[vv].x-newVert.x)<2 && 
								Math.abs(newSolid.vertices[vv].y-newVert.y)<2 && 
								Math.abs(newSolid.vertices[vv].z-newVert.z)<2 ){
								altID = Number(vv);
								newSolid.vertices[vv].refs.push(newPlane);
								//console.log('found');
								continue;
							}
						}
						
						
						if(altID){
							newPlane.verts[on] = altID;
						}else{
							newSolid.vertices.push(newVert);
							newPlane.verts[on] = newSolid.vertices.length-1;
						}
						
						
					}
					
					newSolid.planes.push(newPlane);
							
				}
				
				//for(var vv in newSolid.vertices){
				//	for(var ii = 0; ii < newSolid.planes.length  && newSolid.vertices[vv].refs.length<3; ii+=1){
				//		var hasRef = false;
				//		for(var nn in newSolid.vertices[vv].refs)hasRef = hasRef || newSolid.vertices[vv].refs[nn].id ==  newSolid.planes[ii].id;
				//		if(!hasRef){
				//			var dist = 
				//		}
				//	}					
				//}
				solids.push(newSolid);
				
				newSolid.centroidsNeedUpdate = true;
				newSolid.normalsNeedUpdate = true;
			}
			
			
			for(var ss in solids){
				var mesh = new THREE.Mesh(solids[ss], new THREE.MeshLambertMaterial({color:Math.random()*200000}));
				scene.add(mesh);
			}
			s = solids
		}
		
		var camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 100000);

		var renderer = new THREE.WebGLRenderer();
		renderer.setSize(window.innerWidth, window.innerHeight);
		document.body.appendChild(renderer.domElement);

		
		camera.rotation.x = -0.8;

		var render = function () {
			requestAnimationFrame(render);

			if(keys[65])camera.position.x -= 15;
			if(keys[68])camera.position.x += 15;

			if(keys[83])camera.position.z += 15;
			if(keys[87])camera.position.z -= 15;

			if(keys[69])camera.position.y += 15;
			if(keys[81])camera.position.y -= 15;
			
			renderer.render(scene, camera);
		};

		render();
		
		
		</script>
	</body>
</html>
>>>>>>> 01af195dc0f1700a87ab30a1daf6fcf67713bc87
