
 <html>
	<head>
	<title>Kanvas</title>
	<style>
	@import url(http://fonts.googleapis.com/css?family=Pathway+Gothic+One);
	* {margin:0; padding:0; font-family:'pathway gothic one';}
	html {width:100%; height:100%; display:table; text-align:center}
	body {display:table-cell; vertical-align:middle; background:#a22; color:black; text-transform:uppercase}
	section {width:60%; margin:0 auto; letter-spacing:2px}
	</style>
		
	<script type="application/javascript", src="lib/jquery.js"></script>
		
	</head>  
	<body style="overflow: hidden">  
		<section>
			<h2>Kanvas is an object oriented drawing library which simplifies drawing, animation, and events for HTML5 Canvas!</h2>
		</section>
		<script src="http://code.jquery.com/jquery-latest.js"></script>
		<script>
			(function( $ ){ $.fn.fitText = function( kompressor, options ) { var settings = { 'minFontSize' : Number.NEGATIVE_INFINITY, 'maxFontSize' : Number.POSITIVE_INFINITY }; return this.each(function(){ var $this = $(this); var compressor = kompressor || 1; if ( options ) { $.extend( settings, options ); } var resizer = function () { $this.css('font-size', Math.max(Math.min($this.width() / (compressor*10), parseFloat(settings.maxFontSize)), parseFloat(settings.minFontSize))); }; resizer(); $(window).resize(resizer); }); }; })( jQuery ); 

			$("section").fitText(2.5);
		</script>
		<!--script type="application/javascript", src="js/K_Array.js"></script>-->
		<!--script type="application/javascript", src="js/K_Event.js"></script>-->
		<!--script type="application/javascript", src="js/K_Logger.js"></script>-->
		<!--script type="application/javascript", src="js/K_ImageLoader.js"></script>-->
		<!--script type="application/javascript", src="js/K_KeyTrack.js"></script>-->
		<script type="application/javascript", src="js/KContext.js"></script>
		
		<script>
			var canvas = document.createElement('canvas');
			canvas.width = $(window).width();
			canvas.height = $(window).height();
			$('body').append(canvas);
			var ctx = canvas.getContext('2d');
			var context = new KContext();
			var mouseMoveObjects = [];
			canvas.addEventListener('mousemove', mouseMoveHandler, false)
			canvas.addEventListener('mousedown', click, false)
			
			
			
			var Car = newClass({
				init: function(){
					this.dynamic = true;
					this.x = 100+ Math.random()* (canvas.width-200);
					this.y = 100+ Math.random()* (canvas.height-200);
					this.dir = Math.random()*Math.PI*2,
					this.baseSpeed =  2 + Math.random()*4;
					this.scaleX = this.scaleY = 0.3 + 1 * this.baseSpeed/6
					this.speed = this.baseSpeed;
					this.changed = false;
					this.g = 0;
					this.b = 0;
					this.paused = false;
					this.justRolled = 5;
					this.wave = 0;
					//this.showBox = true;
				},
				every: function(){
					if(!this.paused){
						if(this.speed > this.baseSpeed)this.speed *= 0.99
						else this.speed = this.baseSpeed
						this.b -= 1;
						if(this.b<0)this.b = 0;
						
						this.wave += 0.01
						
						this.x += Math.cos(this.dir + Math.sin(this.wave)/4)*this.speed;
						this.y += Math.sin(this.dir+ Math.sin(this.wave)/4)*this.speed;
						
						if(this.x < -15)this.x = canvas.width+5;
						if(this.y < -15)this.y = canvas.height+5;
						if(this.x > canvas.width+15)this.x = -15;
						if(this.y > canvas.height+15)this.y = -15;
						
						this.rotation = this.dir+ Math.sin(this.wave)/4;
						
						if(this.rolled){
							this.justRolled = 4;
							this.paused = true;
						}else this.justRolled -= 1;
						this.g = Math.round(Math.min((this.speed/this.baseSpeed)/5, 1)*255)
					}
					
				},
				draw: function(){
					if(!this.paused)context.fillStyle = "rgba("+(255-this.g)+","+this.g+","+this.b+", "+((this.baseSpeed)/6)+")"
					else {
						context.fillStyle = "rgba(255,255,255,"+((this.baseSpeed)/60)+")";
					}
					context.beginPath()
					context.moveTo(-10,-10);
					context.lineTo(20,-10)
					context.lineTo(30,0);
					context.lineTo(20,10)
					context.lineTo(-10,10)
					context.lineTo(0,0)
					context.lineTo(-10,-10)
					context.closePath()
					context.fill();
				}
				
			});
			
			function click(){
				for(var ii in cars){
					var a = cars[ii].x - mouseX;
					var b = cars[ii].y - mouseY;
					var distance = Math.sqrt((a*a) + (b*b));
					if(distance < 300){
						distance = Math.pow(((300-distance)/300),8)*0.2 + 0.1;
						cars[ii].paused = false;
						cars[ii].rolled = false;
						var power = distance*120;
						var newDirection = Math.atan2(b,a);
						var newX = Math.cos(cars[ii].dir)*cars[ii].speed + Math.cos(newDirection)*power;
						var newY = Math.sin(cars[ii].dir)*cars[ii].speed + Math.sin(newDirection)*power;
						cars[ii].speed = Math.sqrt((newX * newX) + (newY * newY));
						cars[ii].dir = Math.atan2(newY,newX);
						
					}
				}
			}
			
			var cars = [];
			for(var i = 0; i < 1000; i+=1){
				var car = new Car();
				cars.push(car);
				mouseMoveObjects.push(car);
			}
			
			setInterval(function(){
				ctx.fillStyle = "#000";
				ctx.fillRect(0,0,canvas.width,canvas.height);
				mouseMove()
				for(var i = 0; i < 1000; i+=1){
					cars[i].every();
					cars[i].render(ctx);
				}
			},1);
			
			
		</script>
		
	</body>  
</html>  
